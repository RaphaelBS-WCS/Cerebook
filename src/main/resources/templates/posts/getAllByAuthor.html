<th:block th:fragment="postByAuthor">
    <div id="cards">
    <h1>POSTS</h1>
        <button type="button" class="btn newPost" data-bs-toggle="modal" data-bs-target="#exampleModal">
            Publish a new Post
        </button>
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title text-center" id="exampleModalLabel">Publish a new Post</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form th:action="@{'/posts/create'}" method="POST" enctype="multipart/form-data">
                            <label class ="mb-2">Content</label>
                            <textarea name = "content" placeholder="What's new?"></textarea>
                            <label class ="mb-2">Video</label>
                            <input type="text" name="video" placeholder="youtube embed url"/>
                            <div class="mb-3" id="postPicture">
                                <label class="mb-1">Picture</label>
                                <input type="file" name="postPicture" accept="image/*" onchange="loadFile(event)" />
                            </div>
                            <button type="submit" name="Create" value="Create" class="btn-link">Create</button>
                            <script>
                                var loadFile = function(event) {
                                    var output = document.getElementById('postPicture');
                                    output.src = URL.createObjectURL(event.target.files[0]);
                                    output.style.backgroundImage=`url(${output.src})`;
                                    output.onload = function() {
                                        URL.revokeObjectURL(output.src)
                                    }
                                };
                            </script>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div th:each="post : ${posts}">
            <div class="card-body">
                <div class="card-header">
                    <div class="card-title">
                        <span th:if="${post.author.profilImage}">
                            <img class="rounded-circle profile-avatar" th:src="@{|/images/Profiles/${cerebookUser.id}/profile/${post.author.profilImage}|}" alt="picture">
                        </span>
                        <span th:unless="${post.author.profilImage}">
                            <img class="rounded-circle profile-avatar" src="https://www.pngall.com/wp-content/uploads/5/User-Profile-PNG-Clipart.png" alt="picture">
                        </span>
                        <div class="card-details">
                            <div class="card_userName" th:text="${post.author.user.username}"></div>
                            <div class="card_created_at" th:text="${post.createdAt}"></div>
                        </div>
                        <span th:if="${post.tweetos}">
                            <img src="/images/tweetos.png" class="tweetos" alt="tweetos">
                        </span>
                    </div>
                    <div class="dropdown">
                        <a class="btn dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                            <span class="fas fa-ellipsis-h"></span>
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                            <li><a class="dropdown-item" th:href="'/posts/' + ${post.id} + '/update'">Modifier mon post</a></li>
                            <li>
                                <form method="POST" th:action="'/posts/' + ${post.id} + '/delete'">
                                    <a class="dropdown-item  upline" href="#" onclick="this.parentNode.submit()">Supprimmer mon post</a>
                                </form>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="card-content">
                    <p class="card-text" th:text="${post.content}"></p>
                    <span th:if="${post.video} != null">
                            <iframe th:src="|${post.video}|" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </span>
                    <span th:if="${post.picture} != null">
                            <img th:src="'/images/Posts/' + ${post.picture}" alt="picture">
                    </span>
                </div>
            </div>
        </div>
    </div>
</th:block>

